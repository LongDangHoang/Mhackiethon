<!DOCTYPE html>
<!-- saved from url=(0043) -->
<html data-wf-domain="hackiethon-homepage.webflow.io" data-wf-page="60680d464e5efd21a20c2e40"
    data-wf-site="6067edfbc0153190b5c1ba6e" data-wf-status="1"
    class="w-mod-js wf-montserrat-n5-active wf-montserrat-n9-active wf-montserrat-n7-active wf-montserrat-n6-active wf-montserrat-n4-active wf-montserrat-i9-active wf-montserrat-n1-active wf-montserrat-i1-active wf-montserrat-n2-active wf-montserrat-i2-active wf-montserrat-n3-active wf-montserrat-i3-active wf-montserrat-i4-active wf-montserrat-i5-active wf-montserrat-i6-active wf-montserrat-i7-active wf-montserrat-n8-active wf-montserrat-i8-active wf-active">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>HIIT</title>
    
    <!-- FOR THE STATUS BAR-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, intial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
    <title>Step Progress Bar | Javascript</title>
    <link rel="stylesheet" href="./Status Bar/styles.css"> 

    <meta content="HIIT" property="og:title">
    <meta content="HIIT" property="twitter:title">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    <link href="./HIIT_files/hackiethon-homepage.webflow.9b746ae59.css" rel="stylesheet" type="text/css">
    <script src="./HIIT_files/webfont.js" type="text/javascript"></script>
    <link rel="stylesheet" href="./HIIT_files/css" media="all">
    <script
        type="text/javascript">WebFont.load({ google: { families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"] } });</script>
    <!--[if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif]-->
    <script
        type="text/javascript">!function (o, c) { var n = c.documentElement, t = " w-mod-"; n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch") }(window, document);</script>
    <link href="https://uploads-ssl.webflow.com/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="https://uploads-ssl.webflow.com/img/webclip.png" rel="apple-touch-icon"> 
</head>
<body>
    <header id="nav" class="sticky-nav">
        <nav class="w-container">
            <ul role="list" class="nav-grid w-list-unstyled">
                <li id="w-node-_16871737-8b8b-0952-5dd5-c17120964c30-a20c2e40"><a
                        href="#" class="nav-logo-link"><img
                            src="./HIIT_files/6067eff0bd18466b7feb1bac_M&amp;M&#39;s Fitness Studio.png" height="100"
                            width="100" alt="" class="nav-logo">‍</a></li>
                <li><a href="#" class="nav-link">Workouts</a></li>
                <li><a href="#" class="nav-link">About</a></li>
                <li><a href="#" class="nav-link">Contact</a></li>
                <li><a href="#" class="button w-button">Log in</a></li>
            </ul>
        </nav>
    </header>
    <div>
        <div class="container-2 w-container">
            <h1 class="heading-4">HIGH INTENSITY - HIIT</h1>
            
            <div class="statusBar-body">
                <div class="statusBar-container">
                    <h1 class='statusBar-h1'>Progress</h1>
                    <div class="statusBar-progress-container">
                        <div class="statusBar-progress" id="statusBar-progress"></div>
                        <!--THIS SHOWS THE ICONS FOR THE LANGUAGES-->
                        <div class="statusBar-circle"><i class="fas fa-seedling"></i></div>
                        <div class="statusBar-circle"><i class="fas fa-walking"></i></div>
                        <div class="statusBar-circle"><i class="fas fa-burn"></i></div>
                        <div class="statusBar-circle"><i class="fas fa-heartbeat"></i></div>
                    </div>
                <!-- THIS SHOWS THE BUTTONS-->
                </div>
            </div>

            <div class="w-layout-grid grid-2">
                <h3 id="Exercise" class="heading-6">Exercise: </h3>
                <h3 id="Exercise-type" class="heading-5">Read this after you friend joins!</h3><img
                    src="./HIIT_files/placeholder.60f9b1840c.svg" loading="lazy"
                    id="w-node-bb5bdae8-12cd-1c9c-74fe-efb514c3e7ea-a20c2e40" alt="">
            </div>
            <div class="w-layout-grid grid-3">
                <h3 id="Player-ID" class="heading-6">Player 1: </h3>
                <h3 id="Exercise" class="heading-5 w-node-_6127cee6-3ab9-3aad-f652-c339ceede140-a20c2e40">You</h3>
                <a
                    id="w-node-_6127cee6-3ab9-3aad-f652-c339ceede142-a20c2e40"
                    href="#" class="button-5 w-button">COMPLETE</a>
                <h3 id="Player-ID" class="heading-6">Player 2: </h3>
                <h3 id="friendName" class="heading-5 w-node-_6127cee6-3ab9-3aad-f652-c339ceede146-a20c2e40">Your Friend
                </h3>
                <h3 id='friendStatus' class="heading-5 w-node-_6127cee6-3ab9-3aad-f652-c339ceede146-a20c2e40"></h3>
            </div>
        </div>
    </div>

    <div id='videoContainer' class="container-3 w-container">
    </div>

    <footer id="footer" class="footer">
        <div class="w-container">
            <div class="footer-flex-container"><a href="#"
                    class="footer-logo-link"><img
                        src="./HIIT_files/6067eff0bd18466b7feb1bac_M&amp;M&#39;s Fitness Studio.png" alt=""
                        class="footer-image"></a>
                <div>
                    <h2 class="footer-heading">Fitness Class</h2>
                    <ul role="list" class="w-list-unstyled">
                        <li><a href="#" aria-current="page"
                                class="footer-link w--current">HIIT</a></li>
                        <li><a href="#" class="footer-link">Lower body</a>
                        </li>
                        <li><a href="#" class="footer-link">Upper body</a>
                        </li>
                        <li><a href="#" class="footer-link">Cardio</a></li>
                        <li><a href="#" class="footer-link">Pilates</a></li>
                    </ul>
                </div>
                <div>
                    <h2 class="footer-heading">Menu</h2>
                    <ul role="list" class="w-list-unstyled">
                        <li><a href="#" class="footer-link">Home</a></li>
                        <li><a href="#" class="footer-link">About</a></li>
                    </ul><a href="#" class="footer-link">Contact</a>
                </div>
            </div>
            <div>Copyright © 2021 M&amp;M's Fitness Studio. All rights reserved.</div>
            <!-- MODAL LOGIN DIV -->
            <div style='display: block; position: fixed; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0, 0, 0, 0.4); z-index: 100'
                id='modalLogin'>
                <div style='display: flex; align-content: center; justify-content: center; background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%'>
                    <form action='/connect/' method='POST' id='loginForm'>
                        <label for="room">Enter your room code: </label>
                        <input type='text' name='room' value="3" default="3" style='margin: 10px 0px 15px 0px'/>
                        <label for="name">Enter your name: </label>
                        <input type='text' name='name' style='margin: 10px 0px 10px 0px'/>
                        <br>
                        <input type='submit' id='submitButton' value='submit' />
                    </form>
                </div>
            </div>
            <!-- END MODAL LOGIN DIV -->
        </div>
    </footer>
    <script src="//media.twiliocdn.com/sdk/js/video/releases/2.8.0/twilio-video.min.js"></script> <!-- video api -->
    <script src="./HIIT_files/jquery-3.5.1.min.dc5e7f18c8.js" type="text/javascript"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="./HIIT_files/webflow.adebe3b09.js" type="text/javascript"></script>
    <!--[if lte IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]-->
    <a class="w-webflow-badge" href="https://webflow.com/?utm_campaign=brandjs"><img
            src="./HIIT_files/webflow-badge-icon.f67cd735e3.svg" alt="" style="margin-right: 8px; width: 16px;"><img
            src="./HIIT_files/webflow-badge-text.6faa6a38cd.svg" alt="Made in Webflow"></a>
    <script src='/socket.io/socket.io.js'></script>
    <!-- Sync script -->
    <script type='text/javascript'>

        const connect = Twilio.Video.connect;
        const createLocalTracks = Twilio.Video.createLocalTracks;

        var socket = io();
        var username;
        var roomName;
        var socketID; // your unique id
        var roomID; // for calling

        // html manipulation
        var friendStatus = document.getElementById('friendStatus');
        var friendName = document.getElementById('friendName');
        var form = document.getElementById('loginForm');
        var completeButton = document.getElementById("w-node-_6127cee6-3ab9-3aad-f652-c339ceede142-a20c2e40");
        var exerciseType = document.getElementById('Exercise-type');

        // flag
        var waitFlag = true;

        // hard code task value
        var tasks = ['20 Mountain Climbers', '3 High Plank Chest Taps (15 on each side)', '20 Squat Jumps', '30 Jumping Lunges (15 on each leg)'];

        form.onsubmit = (e) => {
            e.preventDefault(); // prevent reload
            console.log("Something happening?");
            socket.emit("join room", {
                username: form.elements.name.value,
                roomName: form.elements.room.value
            });
            let modal = document.getElementById('modalLogin');
            modal.style.display = "none";
            username = form.elements.name.value;
            roomName = form.elements.room.value;
        }

        completeButton.onclick = (e) => {
            e.preventDefault(); // prevent potential reload or refresh page
            // emit complete task event
            if (waitFlag == false) {
                socket.emit("complete task", {
                    username: username,
                    roomName: roomName,
                    id: socketID
                });
                completeButton.innerHTML = 'I AM DONE!';
                waitFlag = true;
            }
        }

        // socket events handlers
        socket.on("send data", (data) => {
            console.log(data);
            socketID = data.id;
        });

        socket.on("wait other", (data) => {
            waitFlag = true;
            friendStatus.innerHTML = 'Waiting for other player...';
        });

        socket.on('start call', (data) => {
            // extract var
            var accToken = data.accToken;
            console.log(accToken);
            roomID = data.roomID;

            // twilio calling
            let audioOutputDevice;
            let audioInput;
            let videoInput;
            // code from twilio site https://www.twilio.com/docs/video/configuring-audio-video-input-and-output-devices
            navigator.mediaDevices.enumerateDevices().then(devices => {
                audioInput = devices.find(device => device.kind === 'audioinput');
                audioOutputDevice = devices.find(device => device.kind === 'audiooutput');
                videoInput = devices.find(device => device.kind === 'videoinput');
                return createLocalTracks({ audio: { deviceId: audioInput.deviceId }, video: { deviceId: videoInput.deviceId }});
            }).then(localTracks => {
                return connect(accToken, {
                    name: roomID,
                    tracks: localTracks
                });
            }).then(room => {
                console.log("Connected to room " + String(roomID));
                room.on('trackSubscribed', track => {
                    if (track.kind === 'audio') {
                        const audioElement = track.attach();
                        audioElement.setSinkId(audioOutputDevice.deviceId).then(() => {
                            document.body.appendChild(audioElement);
                        });
                    } else if (track.kind === 'video') {
                        const videoElement = track.attach();
                        document.getElementById('videoContainer').appendChild(videoElement);
                    }
                });
            }).catch(err => console.log("Fail to connect"));
        });

        socket.on("start task", (data) => {
            // reset flag
            waitFlag = false;
            completeButton.innerHTML = 'COMPLETE';
            updateProgressBar();

            // display user2 name and status
            console.log(data.user1);
            console.log(data.user2); 
            
            if (data.user1.username == username)
                friendName.innerHTML = data.user2.username;
            else
                friendName.innerHTML = data.user1.username;

            exerciseType.innerHTML = tasks[data.taskNumber - 1]; 
            friendStatus.innerHTML = 'Huff... Huff...';
        });

        socket.on("other complete task", (data) => {
            friendStatus.innerHTML = 'I am done!';
        });

        socket.on("all complete", () => {
            updateProgressBar();
            friendStatus.innerHTML = 'I HAVE COMPLETED!';
            exerciseType.innerHTML = 'Congratulations! You completed the exercise! You burn 9999 calories!';
            socket.emit('end', {
                username: username,
                id: socketID,
                roomID: roomID,
                roomName: roomName
            });

        });

        // status bar script
        const progress = document.getElementById("statusBar-progress");
        const circles = document.querySelectorAll(".statusBar-circle");

        let currentActive = 0;

        function updateProgressBar() {
            currentActive += 1;
            circles.forEach((circle, idx)=>{
                if (idx < currentActive) {
                    circle.classList.add("active");
                } else{
                    circle.classList.remove("active");
                }
            });

            const actives = document.querySelectorAll(".active");

            console.log(actives.length,circles.length);
            progress.style.width = ((actives.length - 1) / (circles.length - 1))*100 + "%";
        }
    </script>
</body>

</html>